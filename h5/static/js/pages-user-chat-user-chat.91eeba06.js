(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-chat-user-chat"],{"080d":function(t,e,n){"use strict";n.r(e);var i=n("21bc"),o=n.n(i);for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a},"1ee0":function(t,e,n){"use strict";var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("8e6e"),n("ac6a"),n("456d");var o=i(n("bd86")),r=i(n("3718")),a=i(n("bcd1")),s=n("2f62");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,o.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l={components:{userChatList:r.default,bootomInput:a.default},data:function(){return{scrollH:500,scrollTop:0,style:{contentH:0,itemH:0},scrollInto:"",loadtext:"点击加载更多",chatList:[]}},computed:u({},(0,s.mapState)({user:function(t){return t.user}})),onLoad:function(t){var e=this;console.log(t),uni.getSystemInfo({success:function(t){"iPhone11"==t.model?e.scrollH=t.windowHeight-101:e.scrollH=t.windowHeight-50.5}});var n=JSON.parse(t.userinfo);if(console.log(n),!n.userid)return uni.showToast({title:"该用户不存在",icon:"none"}),uni.navigateBack({delta:1});this.$chat.CurrentToUser={userid:n.userid,username:n.username,userpic:n.userpic},uni.setNavigationBarTitle({title:n.username})},onReady:function(){this.pageToBottom(),this.__init()},onUnload:function(){this.$chat.CurrentToUser={userid:0,username:"",userpic:""}},methods:{__init:function(){var t=this;try{var e=uni.getSystemInfoSync();this.style.contentH=e.windowHeight-uni.upx2px(120)}catch(n){}this.getdata(),this.pageToBottom(),uni.$on("UserChat",(function(e){t.chatList.push(t.$chat.__format(e,{type:"chatdetail",isme:!1,olddata:t.chatList}))}))},submit:function(t){if(!t)return uni.showToast({title:"请输入你要发送的消息~",icon:"none"});var e=this.$chat.send({type:"text",data:t});console.log(e),this.request.chatSend(e,{token:!0,checkToken:!0,checkAuth:!0}).then((function(t){console.log(t)})),this.chatList.push(this.$chat.__format(e,{type:"chatdetail",olddata:this.chatList,isme:!0})),this.pageToBottom()},pageToBottom:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=this.chatList.length-1;t<0||(this.scrollInto="chat"+t)},getdata:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var e="chatdetail_"+this.user.id+"_"+this.$chat.CurrentToUser.userid,n=uni.getStorageSync(e);if(n=n?JSON.parse(n):[],!t&&n.length>10)return this.chatList=n.splice(n.length-10,n.length-1);this.chatList=n,this.loadtext=""}catch(i){uni.showToast({title:"加载失败",icon:"none"})}},loadmore:function(){"点击加载更多"===this.loadtext&&(this.loadtext="加载中...",this.getdata(!0),this.pageToBottom())}}};e.default=l},"21bc":function(t,e,n){"use strict";var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("c5f6");var o=i(n("e43a")),r=1,a={props:{item:Object,index:Number,pretime:[Number,String]},methods:{},onLoad:function(){},computed:{isSelf:function(){return r==this.item.user_id},shortTime:function(){return(0,o.default)(this.item.creat_time).diff(this.pretime,"seconds")>300?(0,o.default)(this.item.creat_time).format("HH:mm"):""}}};e.default=a},3718:function(t,e,n){"use strict";n.r(e);var i=n("3e63"),o=n("080d");for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);var a,s=n("f0c5"),c=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"694c6a97",null,!1,i["a"],a);e["default"]=c.exports},"3e63":function(t,e,n){"use strict";var i,o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[t.shortTime?n("v-uni-view",{staticClass:"py-20 flex font-sm text-light-muted"},[t._v(t._s(t.shortTime))]):t._e(),n("v-uni-view",{staticClass:"px-20 my-20",staticStyle:{display:"flex","align-items":"flex-start"},style:t.item.isme?"flex-direction: row-reverse;":""},[n("v-uni-image",{staticClass:"rounded-circle ",staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:t.item.userpic,mode:""}}),n("v-uni-view",{staticClass:"bg-light pd-1 rounded mx-20 flex",staticStyle:{"max-width":"400rpx","min-width":"100rpx"},style:t.item.isme?"background-color: #16C2C2;color:#ffffff":""},[t._v(t._s(t.item.data))])],1)],1)},r=[];n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i}))},"4b9b":function(t,e,n){"use strict";var i={"user-chat-list":n("3718").default},o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("v-uni-scroll-view",{staticStyle:{position:"absolute",left:"0",top:"0",right:"0",bottom:"50rpx"},style:"height:"+t.scrollH+"px",attrs:{"scroll-y":"true","scroll-with-animation":!0,"scroll-into-view":t.scrollInto}},[n("v-uni-view",{staticClass:"text-light-muted font-sm flex pt-10",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.loadmore.apply(void 0,arguments)}}},[t._v(t._s(t.loadtext))]),t._l(t.chatList,(function(e,i){return[n("v-uni-view",{key:i+"_0",attrs:{id:"chat"+i}},[n("user-chat-list",{attrs:{item:e,index:i,pretime:i>0?t.chatList[i-1].creat_time:0}})],1)]}))],2),n("bootom-input",{on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}})],1)},r=[];n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i}))},"777c":function(t,e,n){"use strict";n.r(e);var i=n("827d"),o=n.n(i);for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a},8226:function(t,e,n){"use strict";var i,o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"fixed-bottom border-top bg-white",staticStyle:{height:"100rpx",display:"flex","align-items":"center"}},[n("v-uni-input",{staticClass:" flex-1 rounded bg-light ml-20",staticStyle:{padding:"5rpx"},attrs:{type:"text","confirm-type":"send",value:"",placeholder:"文明发言",focus:t.focus},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)},blur:function(e){arguments[0]=e=t.$handleEvent(e),t.$emit("blur")}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),n("v-uni-view",{staticClass:"iconfont flex font-md animated ",staticStyle:{width:"100rpx"},attrs:{"hover-class":"jello font-color"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}},[t._v("")])],1)},r=[];n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i}))},"827d":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={props:{focus:{type:Boolean,default:!1}},data:function(){return{content:""}},methods:{submit:function(){if(""==this.content)return uni.showToast({title:"消息不能为空",icon:"none"});this.$emit("submit",this.content),this.content=""}}};e.default=i},bcd1:function(t,e,n){"use strict";n.r(e);var i=n("8226"),o=n("777c");for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);var a,s=n("f0c5"),c=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"02795324",null,!1,i["a"],a);e["default"]=c.exports},c0f4:function(t,e,n){"use strict";n.r(e);var i=n("4b9b"),o=n("f112");for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);var a,s=n("f0c5"),c=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"1f9d15f5",null,!1,i["a"],a);e["default"]=c.exports},f112:function(t,e,n){"use strict";n.r(e);var i=n("1ee0"),o=n.n(i);for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a}}]);